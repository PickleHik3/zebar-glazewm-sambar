<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Personal Rose Pine Base - Zebar</title>
  <style>
    :root {
      /* Rose Pine color palette */
      --rp-base: #191724;
      --rp-surface: #1f1d2e;
      --rp-overlay: #26233a;
      --rp-muted: #6e6a86;
      --rp-subtle: #908caa;
      --rp-text: #e0def4;
      --rp-love: #eb6f92;
      --rp-gold: #f6c177;
      --rp-rose: #ebbcba;
      --rp-pine: #31748f;
      --rp-foam: #9ccfd8;
      --rp-iris: #c4a7e7;
      --rp-highlight-low: #21202e;
      --rp-highlight-med: #403d52;
      --rp-highlight-high: #524f67;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      font-size: 14px;
      background: var(--rp-base);
      color: var(--rp-text);
      height: 42px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      overflow: hidden;
    }

    .left, .center, .right {
      display: flex;
      align-items: center;
      gap: 12px;
      height: 100%;
    }

    .left {
      flex: 1;
      justify-content: flex-start;
    }

    .center {
      flex: 1;
      justify-content: center;
    }

    .right {
      flex: 1;
      justify-content: flex-end;
    }

    /* Logo */
    .logo {
      color: var(--rp-iris);
      font-size: 18px;
      margin-right: 8px;
    }

    /* Workspaces */
    .workspaces {
      display: flex;
      gap: 6px;
    }

    .workspace {
      background: transparent;
      border: 1px solid var(--rp-highlight-med);
      color: var(--rp-muted);
      padding: 4px 12px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 13px;
    }

    .workspace:hover {
      background: var(--rp-highlight-low);
      border-color: var(--rp-subtle);
      color: var(--rp-text);
    }

    .workspace.focused {
      background: var(--rp-iris);
      border-color: var(--rp-iris);
      color: var(--rp-base);
    }

    .workspace.displayed {
      background: var(--rp-highlight-med);
      border-color: var(--rp-iris);
      color: var(--rp-text);
    }

    /* Date */
    .date {
      font-weight: 500;
      color: var(--rp-text);
    }

    /* System info widgets */
    .widget {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      background: var(--rp-surface);
      border-radius: 6px;
      font-size: 13px;
    }

    .widget i {
      font-size: 14px;
    }

    /* Network */
    .network i {
      color: var(--rp-foam);
    }

    /* Memory */
    .memory i {
      color: var(--rp-iris);
    }
    .memory.high {
      color: var(--rp-love);
    }

    /* CPU */
    .cpu i {
      color: var(--rp-rose);
    }
    .cpu.high-usage {
      color: var(--rp-love);
    }

    /* Battery */
    .battery i {
      color: var(--rp-pine);
    }
    .battery.charging i:first-child {
      color: var(--rp-gold);
    }
    .battery.low {
      color: var(--rp-love);
    }

    /* Weather */
    .weather i {
      color: var(--rp-gold);
    }

    /* Paused/Binding modes */
    .paused-button, .binding-mode {
      background: var(--rp-love);
      color: var(--rp-base);
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
    }

    .tiling-direction {
      background: transparent;
      border: 1px solid var(--rp-rose);
      color: var(--rp-rose);
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }

    .tiling-direction:hover {
      background: var(--rp-rose);
      color: var(--rp-base);
    }

    /* Responsive adjustments */
    @media (max-width: 1200px) {
      .right .widget {
        padding: 2px 6px;
      }
      .workspaces .workspace {
        padding: 2px 8px;
      }
    }
  </style>
</head>
<body>
  <div class="left">
    <i class="logo nf nf-fa-windows"></i>
    <div class="workspaces" id="workspaces"></div>
  </div>
  
  <div class="center">
    <div class="date" id="date">Loading...</div>
  </div>
  
  <div class="right">
    <div id="glazewm-controls"></div>
    <div class="widget network" id="network" style="display: none;">
      <i class="nf nf-md-wifi"></i>
      <span id="network-info">Disconnected</span>
    </div>
    <div class="widget memory" id="memory" style="display: none;">
      <i class="nf nf-fae-chip"></i>
      <span id="memory-usage">0%</span>
    </div>
    <div class="widget cpu" id="cpu" style="display: none;">
      <i class="nf nf-oct-cpu"></i>
      <span id="cpu-usage">0%</span>
    </div>
    <div class="widget battery" id="battery" style="display: none;">
      <i class="nf nf-fa-battery_3"></i>
      <span id="battery-level">0%</span>
    </div>
    <div class="widget weather" id="weather" style="display: none;">
      <i class="nf nf-weather-day_sunny"></i>
      <span id="weather-temp">--°C</span>
    </div>
  </div>

  <script type="module">
    import * as zebar from 'https://esm.sh/zebar@3.0';

    const providers = zebar.createProviderGroup({
      glazewm: { type: 'glazewm' },
      date: { type: 'date', formatting: 'EEE d MMM HH:mm' },
      network: { type: 'network' },
      memory: { type: 'memory' },
      cpu: { type: 'cpu' },
      battery: { type: 'battery' },
      weather: { type: 'weather' }
    });

    let output = {};

    providers.onOutput(() => {
      output = providers.outputMap;
      updateUI();
    });

    function updateUI() {
      updateWorkspaces();
      updateDate();
      updateGlazeWMControls();
      updateNetwork();
      updateMemory();
      updateCPU();
      updateBattery();
      updateWeather();
    }

    function updateWorkspaces() {
      const workspacesEl = document.getElementById('workspaces');
      if (!output.glazewm) return;

      workspacesEl.innerHTML = '';
      output.glazewm.currentWorkspaces.forEach(workspace => {
        const button = document.createElement('button');
        button.className = 'workspace';
        button.textContent = workspace.displayName || workspace.name;
        
        if (workspace.hasFocus) button.classList.add('focused');
        if (workspace.isDisplayed) button.classList.add('displayed');
        
        button.onclick = () => output.glazewm.runCommand(`focus --workspace ${workspace.name}`);
        workspacesEl.appendChild(button);
      });
    }

    function updateDate() {
      const dateEl = document.getElementById('date');
      if (output.date) {
        dateEl.textContent = output.date.formatted;
      }
    }

    function updateGlazeWMControls() {
      const controlsEl = document.getElementById('glazewm-controls');
      if (!output.glazewm) return;

      controlsEl.innerHTML = '';

      if (output.glazewm.isPaused) {
        const pausedBtn = document.createElement('button');
        pausedBtn.className = 'paused-button';
        pausedBtn.textContent = 'PAUSED';
        pausedBtn.onclick = () => output.glazewm.runCommand('wm-toggle-pause');
        controlsEl.appendChild(pausedBtn);
      }

      output.glazewm.bindingModes.forEach(mode => {
        const modeBtn = document.createElement('button');
        modeBtn.className = 'binding-mode';
        modeBtn.textContent = mode.displayName || mode.name;
        modeBtn.onclick = () => output.glazewm.runCommand(`wm-disable-binding-mode --name ${mode.name}`);
        controlsEl.appendChild(modeBtn);
      });

      const tilingBtn = document.createElement('button');
      tilingBtn.className = `tiling-direction nf ${
        output.glazewm.tilingDirection === 'horizontal' 
          ? 'nf-md-swap_horizontal' 
          : 'nf-md-swap_vertical'
      }`;
      tilingBtn.onclick = () => output.glazewm.runCommand('toggle-tiling-direction');
      controlsEl.appendChild(tilingBtn);
    }

    function updateNetwork() {
      const networkEl = document.getElementById('network');
      const infoEl = document.getElementById('network-info');
      const iconEl = networkEl.querySelector('i');
      
      if (!output.network) {
        networkEl.style.display = 'none';
        return;
      }

      networkEl.style.display = 'flex';
      const iface = output.network.defaultInterface;
      
      if (iface?.type === 'wifi') {
        const strength = output.network.defaultGateway?.signalStrength || 0;
        if (strength >= 80) iconEl.className = 'nf nf-md-wifi_strength_4';
        else if (strength >= 65) iconEl.className = 'nf nf-md-wifi_strength_3';
        else if (strength >= 40) iconEl.className = 'nf nf-md-wifi_strength_2';
        else if (strength >= 25) iconEl.className = 'nf nf-md-wifi_strength_1';
        else iconEl.className = 'nf nf-md-wifi_strength_outline';
        
        infoEl.textContent = output.network.defaultGateway?.ssid || 'WiFi';
      } else if (iface?.type === 'ethernet') {
        iconEl.className = 'nf nf-md-ethernet_cable';
        infoEl.textContent = 'Ethernet';
      } else {
        iconEl.className = 'nf nf-md-wifi_strength_off_outline';
        infoEl.textContent = 'Disconnected';
      }
    }

    function updateMemory() {
      const memoryEl = document.getElementById('memory');
      const usageEl = document.getElementById('memory-usage');
      
      if (!output.memory) {
        memoryEl.style.display = 'none';
        return;
      }

      memoryEl.style.display = 'flex';
      const usage = Math.round(output.memory.usage);
      usageEl.textContent = `${usage}%`;
      
      memoryEl.classList.toggle('high', usage > 85);
    }

    function updateCPU() {
      const cpuEl = document.getElementById('cpu');
      const usageEl = document.getElementById('cpu-usage');
      
      if (!output.cpu) {
        cpuEl.style.display = 'none';
        return;
      }

      cpuEl.style.display = 'flex';
      const usage = Math.round(output.cpu.usage);
      usageEl.textContent = `${usage}%`;
      
      cpuEl.classList.toggle('high-usage', usage > 85);
    }

    function updateBattery() {
      const batteryEl = document.getElementById('battery');
      const levelEl = document.getElementById('battery-level');
      const iconEl = batteryEl.querySelector('i');
      
      if (!output.battery) {
        batteryEl.style.display = 'none';
        return;
      }

      batteryEl.style.display = 'flex';
      const level = Math.round(output.battery.chargePercent);
      levelEl.textContent = `${level}%`;
      
      // Update battery icon based on level
      if (level > 90) iconEl.className = 'nf nf-fa-battery_4';
      else if (level > 70) iconEl.className = 'nf nf-fa-battery_3';
      else if (level > 40) iconEl.className = 'nf nf-fa-battery_2';
      else if (level > 20) iconEl.className = 'nf nf-fa-battery_1';
      else iconEl.className = 'nf nf-fa-battery_0';
      
      batteryEl.classList.toggle('low', level <= 20);
      batteryEl.classList.toggle('charging', output.battery.isCharging);
      
      // Add charging icon if charging
      if (output.battery.isCharging && !batteryEl.querySelector('.charging-icon')) {
        const chargingIcon = document.createElement('i');
        chargingIcon.className = 'nf nf-md-power_plug charging-icon';
        batteryEl.insertBefore(chargingIcon, iconEl);
      } else if (!output.battery.isCharging) {
        const chargingIcon = batteryEl.querySelector('.charging-icon');
        if (chargingIcon) chargingIcon.remove();
      }
    }

    function updateWeather() {
      const weatherEl = document.getElementById('weather');
      const tempEl = document.getElementById('weather-temp');
      const iconEl = weatherEl.querySelector('i');
      
      if (!output.weather) {
        weatherEl.style.display = 'none';
        return;
      }

      weatherEl.style.display = 'flex';
      tempEl.textContent = `${Math.round(output.weather.celsiusTemp)}°C`;
      
      // Update weather icon based on status
      const status = output.weather.status;
      const iconMap = {
        'clear_day': 'nf nf-weather-day_sunny',
        'clear_night': 'nf nf-weather-night_clear',
        'cloudy_day': 'nf nf-weather-day_cloudy',
        'cloudy_night': 'nf nf-weather-night_alt_cloudy',
        'light_rain_day': 'nf nf-weather-day_sprinkle',
        'light_rain_night': 'nf nf-weather-night_alt_sprinkle',
        'heavy_rain_day': 'nf nf-weather-day_rain',
        'heavy_rain_night': 'nf nf-weather-night_alt_rain',
        'snow_day': 'nf nf-weather-day_snow',
        'snow_night': 'nf nf-weather-night_alt_snow',
        'thunder_day': 'nf nf-weather-day_lightning',
        'thunder_night': 'nf nf-weather-night_alt_lightning'
      };
      
      iconEl.className = iconMap[status] || 'nf nf-weather-day_sunny';
    }

    // Load Nerd Fonts CSS
    const link = document.createElement('link');
    link.rel = 'stylesheet';
    link.href = 'https://www.nerdfonts.com/assets/css/webfont.css';
    document.head.appendChild(link);
  </script>
</body>
</html>
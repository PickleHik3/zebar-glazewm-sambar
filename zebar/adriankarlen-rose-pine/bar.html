<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Adrian Karlen Rose Pine - Zebar</title>
  <link rel="stylesheet" href="https://www.nerdfonts.com/assets/css/webfont.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@latest/dist/tabler-icons.min.css">
  <style>
    :root {
      /* Rose Pine Main */
      --rp-base: #191724;
      --rp-base-alpha-bg: #191724dd;
      --rp-surface: #1f1d2e;
      --rp-overlay: #26233a;
      --rp-muted: #6e6a86;
      --rp-subtle: #908caa;
      --rp-text: #e0def4;
      --rp-love: #eb6f92;
      --rp-gold: #f6c177;
      --rp-rose: #ebbcba;
      --rp-pine: #31748f;
      --rp-foam: #9ccfd8;
      --rp-iris: #c4a7e7;
      --rp-highlight-low: #21202e;
      --rp-highlight-med: #403d52;
      --rp-highlight-high: #524f67;

      /* Theme Variables */
      --text: var(--rp-text);
      --bg: var(--rp-base-alpha-bg);
      --border: var(--rp-base);
      --icon: var(--rp-love);
      --memory: var(--rp-iris);
      --cpu: var(--rp-rose);
      --cpu-high-usage: var(--rp-love);
      --battery-good: var(--rp-foam);
      --battery-mid: var(--rp-gold);
      --battery-low: var(--rp-love);
      --ws-1: var(--rp-love);
      --ws-2: var(--rp-gold);
      --ws-3: var(--rp-rose);
      --ws-4: var(--rp-pine);
      --ws-5: var(--rp-foam);
      --ws-6: var(--rp-iris);
      --weather: var(--rp-gold);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "SF Mono", ui-monospace, monospace;
      font-size: 16px;
      font-weight: 600;
      background: transparent;
      color: var(--text);
      height: 60px;
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      align-items: center;
      padding: 10px 20px;
      overflow: hidden;
    }

    /* Animation */
    @keyframes flash {
      from { opacity: 1.0; }
      50% { opacity: 0.5; }
      to { opacity: 1.0; }
    }

    /* Left Section */
    .left {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 6px;
    }

    .left-group {
      display: flex;
      align-items: center;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 9999px;
      height: 40px;
      width: fit-content;
      padding: 4px;
      gap: 4px;
    }

    .rose-icon {
      color: var(--icon);
      background: color-mix(in srgb, currentColor 10%, transparent);
      padding: 6px;
      border-radius: 9999px;
      font-size: 20px;
    }

    .stat-widget {
      background: color-mix(in srgb, currentColor 10%, transparent);
      border-radius: 9999px;
      padding: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .stat-widget i {
      font-size: 20px;
    }

    .memory { color: var(--memory); }
    .cpu { color: var(--cpu); }
    .cpu.high-usage { 
      color: var(--cpu-high-usage); 
      animation: flash 0.5s infinite;
    }

    .battery { color: var(--battery-good); }
    .battery.mid { color: var(--battery-mid); }
    .battery.low { color: var(--battery-low); }
    .battery.critical { 
      color: var(--battery-low); 
      animation: flash 1s infinite;
    }

    /* Center Section */
    .center {
      justify-self: center;
    }

    .workspace-group {
      height: 40px;
      display: flex;
      align-items: center;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 9999px;
      font-weight: 1000;
    }

    .workspace {
      background: transparent;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .workspace i {
      padding: 8px;
      background: color-mix(in srgb, currentColor 10%, transparent);
      border-radius: 9999px;
      font-size: 16px;
    }

    /* Workspace Colors */
    .workspace:nth-child(6n+1) i { color: var(--ws-1); }
    .workspace:nth-child(6n+2) i { color: var(--ws-2); }
    .workspace:nth-child(6n+3) i { color: var(--ws-3); }
    .workspace:nth-child(6n+4) i { color: var(--ws-4); }
    .workspace:nth-child(6n+5) i { color: var(--ws-5); }
    .workspace:nth-child(6n+6) i { color: var(--ws-6); }

    /* Right Section */
    .right {
      justify-self: end;
      height: 40px;
      display: flex;
      align-items: center;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 9999px;
      padding: 4px;
      gap: 6px;
    }

    .weather-widget {
      color: var(--weather);
      background: color-mix(in srgb, currentColor 10%, transparent);
      border-radius: 9999px;
      padding: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .weather-widget i {
      font-size: 20px;
    }

    .separator {
      color: var(--rp-muted);
      font-size: 12px;
      margin: 0 4px;
    }

    .clock {
      padding-right: 6px;
      color: var(--text);
    }

    /* Hide widgets when data not available */
    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="left">
    <div class="left-group">
      <div class="rose-icon">
        <i class="nf nf-md-flower_tulip"></i>
      </div>
      <div class="stat-widget memory hidden" id="memory-widget">
        <i class="ti ti-rocket"></i>
        <span id="memory-value">0 GiB</span>
      </div>
      <div class="stat-widget cpu hidden" id="cpu-widget">
        <i class="ti ti-cpu"></i>
        <span id="cpu-value">0%</span>
      </div>
      <div class="stat-widget battery hidden" id="battery-widget">
        <i class="ti ti-bolt"></i>
        <span id="battery-value">0%</span>
      </div>
    </div>
  </div>

  <div class="center">
    <div class="workspace-group" id="workspaces">
      <!-- Workspaces will be populated here -->
    </div>
  </div>

  <div class="right">
    <div class="weather-widget hidden" id="weather-widget">
      <i class="nf nf-weather-day_sunny" id="weather-icon"></i>
      <span id="weather-temp">--°</span>
    </div>
    <div class="separator">
      <i class="nf nf-oct-dot_fill"></i>
    </div>
    <div class="clock" id="clock">
      Loading...
    </div>
  </div>

  <script type="module">
    import * as zebar from 'https://esm.sh/zebar@3.0';

    const providers = zebar.createProviderGroup({
      glazewm: { type: 'glazewm' },
      date: { type: 'date', formatting: 't' },
      memory: { type: 'memory' },
      cpu: { type: 'cpu' },
      battery: { type: 'battery' },
      weather: { type: 'weather' }
    });

    let output = {};

    providers.onOutput(() => {
      output = providers.outputMap;
      updateUI();
    });

    function updateUI() {
      updateWorkspaces();
      updateClock();
      updateMemory();
      updateCPU();
      updateBattery();
      updateWeather();
    }

    function updateWorkspaces() {
      const workspacesEl = document.getElementById('workspaces');
      if (!output.glazewm) return;

      workspacesEl.innerHTML = '';
      output.glazewm.currentWorkspaces.forEach(workspace => {
        const button = document.createElement('button');
        button.className = 'workspace';
        button.innerHTML = `<i class="nf ${workspace.hasFocus ? 'nf-cod-circle_filled' : 'nf-cod-circle'}"></i>`;
        button.onclick = () => output.glazewm.runCommand(`focus --workspace ${workspace.name}`);
        workspacesEl.appendChild(button);
      });
    }

    function updateClock() {
      const clockEl = document.getElementById('clock');
      if (output.date) {
        clockEl.textContent = output.date.formatted;
      }
    }

    function updateMemory() {
      const memoryWidget = document.getElementById('memory-widget');
      const memoryValue = document.getElementById('memory-value');
      
      if (output.memory) {
        const memoryGiB = (output.memory.usedMemory / 1000000000).toFixed(2);
        memoryValue.textContent = `${memoryGiB} GiB`;
        memoryWidget.classList.remove('hidden');
      } else {
        memoryWidget.classList.add('hidden');
      }
    }

    function updateCPU() {
      const cpuWidget = document.getElementById('cpu-widget');
      const cpuValue = document.getElementById('cpu-value');
      
      if (output.cpu) {
        const usage = Math.round(output.cpu.usage);
        cpuValue.textContent = `${usage}%`;
        cpuWidget.classList.toggle('high-usage', usage > 85);
        cpuWidget.classList.remove('hidden');
      } else {
        cpuWidget.classList.add('hidden');
      }
    }

    function updateBattery() {
      const batteryWidget = document.getElementById('battery-widget');
      const batteryValue = document.getElementById('battery-value');
      
      if (output.battery) {
        const percent = Math.round(output.battery.chargePercent);
        batteryValue.textContent = `${percent}%`;
        
        // Update battery class based on charge level
        batteryWidget.classList.remove('good', 'mid', 'low', 'critical');
        if (percent > 75) {
          batteryWidget.classList.add('good');
        } else if (percent > 50) {
          batteryWidget.classList.add('mid');
        } else if (percent > 25) {
          batteryWidget.classList.add('low');
        } else {
          batteryWidget.classList.add('critical');
        }
        
        batteryWidget.classList.remove('hidden');
      } else {
        batteryWidget.classList.add('hidden');
      }
    }

    function updateWeather() {
      const weatherWidget = document.getElementById('weather-widget');
      const weatherIcon = document.getElementById('weather-icon');
      const weatherTemp = document.getElementById('weather-temp');
      
      if (output.weather) {
        const temp = Math.round(output.weather.celsiusTemp);
        weatherTemp.textContent = `${temp}°`;
        
        // Update weather icon
        const iconMap = {
          'clear_day': 'nf-weather-day_sunny',
          'clear_night': 'nf-weather-night_clear',
          'cloudy_day': 'nf-weather-day_cloudy',
          'cloudy_night': 'nf-weather-night_alt_cloudy',
          'light_rain_day': 'nf-weather-day_sprinkle',
          'light_rain_night': 'nf-weather-night_alt_sprinkle',
          'heavy_rain_day': 'nf-weather-day_rain',
          'heavy_rain_night': 'nf-weather-night_alt_rain',
          'snow_day': 'nf-weather-day_snow',
          'snow_night': 'nf-weather-night_alt_snow',
          'thunder_day': 'nf-weather-day_lightning',
          'thunder_night': 'nf-weather-night_alt_lightning'
        };
        
        weatherIcon.className = `nf ${iconMap[output.weather.status] || 'nf-weather-day_sunny'}`;
        weatherWidget.classList.remove('hidden');
      } else {
        weatherWidget.classList.add('hidden');
      }
    }
  </script>
</body>
</html>